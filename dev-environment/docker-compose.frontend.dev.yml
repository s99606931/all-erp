version: '3.8'

# Micro Frontend 앱들
# Shell 앱 (Host) + Remote 앱 10개

services:
  # ============================================
  # Shell 앱 (Host)
  # ============================================
  shell:
    build:
      context: ..
      dockerfile: apps/frontend/shell/Dockerfile.dev
    container_name: shell
    ports:
      - "3000:3000"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/shell/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # ============================================
  # Remote 앱들
  # ============================================
  
  # System MFE
  system-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/system-mfe/Dockerfile.dev
    container_name: system-mfe
    ports:
      - "3100:3100"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/system-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # HR MFE
  hr-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/hr-mfe/Dockerfile.dev
    container_name: hr-mfe
    ports:
      - "3101:3101"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/hr-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Payroll MFE
  payroll-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/payroll-mfe/Dockerfile.dev
    container_name: payroll-mfe
    ports:
      - "3102:3102"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/payroll-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Attendance MFE
  attendance-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/attendance-mfe/Dockerfile.dev
    container_name: attendance-mfe
    ports:
      - "3103:3103"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/attendance-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Budget MFE
  budget-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/budget-mfe/Dockerfile.dev
    container_name: budget-mfe
    ports:
      - "3104:3104"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/budget-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Treasury MFE
  treasury-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/treasury-mfe/Dockerfile.dev
    container_name: treasury-mfe
    ports:
      - "3105:3105"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/treasury-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Accounting MFE
  accounting-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/accounting-mfe/Dockerfile.dev
    container_name: accounting-mfe
    ports:
      - "3106:3106"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/accounting-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Asset MFE
  asset-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/asset-mfe/Dockerfile.dev
    container_name: asset-mfe
    ports:
      - "3107:3107"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/asset-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # Inventory MFE
  inventory-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/inventory-mfe/Dockerfile.dev
    container_name: inventory-mfe
    ports:
      - "3108:3108"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/inventory-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

  # General Affairs MFE
  general-affairs-mfe:
    build:
      context: ..
      dockerfile: apps/frontend/general-affairs-mfe/Dockerfile.dev
    container_name: general-affairs-mfe
    ports:
      - "3109:3109"
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
      - /workspace/node_modules
    env_file:
      - ../apps/frontend/general-affairs-mfe/.env
    networks:
      - all-erp-network
    # command: pnpm dev --host (Delegated to Dockerfile CMD)

networks:
  all-erp-network:
    external: true
