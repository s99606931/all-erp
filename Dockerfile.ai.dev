FROM node:22-slim

# 작업 디렉토리 설정
WORKDIR /workspace

# pnpm 설치
RUN corepack enable && corepack prepare pnpm@latest --activate

# 의존성 파일 복사
COPY package.json pnpm-lock.yaml ./
COPY nx.json tsconfig.base.json ./

# 의존성 설치
RUN pnpm install --frozen-lockfile

# 소스 코드는 볼륨 마운트로 제공됨 (개발 환경)
# AI 서비스는 MongoDB + Milvus 사용 (Prisma 불필요)

# 개발 서버 실행 (docker-compose에서 command로 오버라이드)
CMD ["pnpm", "nx", "serve"]
