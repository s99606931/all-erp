# PRD: GitLab CE 설치 및 설정

## 1. 개요 (Overview)
- **Task ID**: 2.0_gitlab_setup
- **목표**: 자체 호스팅 GitLab CE를 구축하여 소스코드 관리, CI/CD, Container Registry를 통합 운영합니다.
- **관련 로드맵**: Phase 2 - DevOps 환경 구축 (우선)

## 2. 상세 요구사항 (Requirements)
- [ ] **GitLab CE 설치**: Docker 기반 GitLab Community Edition 설치
- [ ] **Container Registry 활성화**: 내장 컨테이너 레지스트리 설정
- [ ] **HTTPS 설정**: SSL/TLS 인증서 적용 (Let's Encrypt 또는 자체 인증서)
- [ ] **백업 전략**: 자동 백업 스케줄 설정
- [ ] **사용자 및 권한 관리**: 개발팀 계정 및 그룹 생성

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 설치 방법
- **선택지 A**: Docker Compose (권장)
- **선택지 B**: Omnibus 패키지 (직접 설치)
- **선택지 C**: Kubernetes Helm Chart
- **✅ 권장사항**: **Docker Compose**
    - **이유**: 빠른 설치, 쉬운 관리, 백업/복원 용이

### 3.2 Container Registry
- **선택지 A**: GitLab 내장 Container Registry
- **선택지 B**: 별도 Harbor 구축
- **✅ 권장사항**: **GitLab 내장 Container Registry**
    - **이유**: 
        - 통합 인증 (한 번의 로그인으로 Git + Registry 접근)
        - CI/CD 파이프라인과 자동 연동
        - 관리 포인트 최소화 (하나의 시스템만 운영)
        - 초기 단계에서 충분한 기능 제공

### 3.3 도메인 구성
```
https://gitlab.your-domain.com       # GitLab 웹 UI
https://registry.your-domain.com     # Container Registry
```

## 4. 작업 단위 (Work Breakdown)

### 4.1 GitLab CE Docker Compose 설정

> **참고**: GitLab CE는 이미 `dev-environment/docker-compose.devops.yml`에 정의되어 있습니다.  
> 설정 파일: [docker-compose.devops.yml](../../dev-environment/docker-compose.devops.yml)

현재 설정된 GitLab 구성:
- **호스트명**: `gitlab.all-erp.local`
- **포트**: 8980 (HTTP), 8922 (SSH), 5050 (Container Registry)
- **초기 root 비밀번호**: `changeme123!`
- **볼륨**: `./volumes/gitlab/config`, `./volumes/gitlab/logs`, `./volumes/gitlab/data`

### 4.2 GitLab 실행
```bash
# GitLab 및 기타 DevOps 도구 실행
cd dev-environment
docker compose -f docker-compose.devops.yml up -d

# GitLab 준비 상태 확인 (최대 5분 소요)
docker compose -f docker-compose.devops.yml logs -f gitlab

# 웹 접속: http://localhost:8980
# 초기 root 비밀번호: changeme123!

# 설정 변경 후:
# - Admin Area > Settings > General > Sign-up restrictions
# - Admin Area > Settings > CI/CD > Container Registry
```

### 4.3 CI/CD Runner 등록
```bash
# GitLab Runner 설치 (별도 서버 또는 로컬)
docker run -d --name gitlab-runner --restart always \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v gitlab-runner-config:/etc/gitlab-runner \
  gitlab/gitlab-runner:latest

# Runner 등록
docker exec -it gitlab-runner gitlab-runner register
# URL: http://gitlab.all-erp.local:8980
# Token: (GitLab Admin Area에서 확인)
# Executor: docker
# Default Image: node:22-alpine
```

> **참고**: [Docker-First Workflow Guide](../../guides/docker-first-workflow.md)

## 5. 승인 기준 (Acceptance Criteria)
- [ ] **GitLab 웹 UI 접속**: `http://localhost:8980`에서 GitLab 접속 가능
- [ ] **테스트 프로젝트 생성**: 프로젝트를 생성하고 코드를 push
- [ ] **Container Registry 동작**: `http://localhost:5050`에서 이미지 push/pull 가능
- [ ] **CI/CD Runner 등록**: Runner가 GitLab에 정상 등록됨

## 6. 참조 문서
- [GitLab CE 공식 문서](https://docs.gitlab.com/ee/install/docker.html)
- [Container Registry 가이드](https://docs.gitlab.com/ee/user/packages/container_registry/)
