# Task 3.2: RAG (Retrieval-Augmented Generation) Implementation with Milvus

## 1. 개요 (Overview)

- **Task ID**: 3.2
- **목표**: `ai-service`에 Vector DB(Milvus)를 연동하고, RAG 파이프라인을 구축하여 기업 데이터 기반의 질의응답 시스템을 구현한다.
- **선행 작업**: Task 3.1 (AI Service Setup), Milvus 인프라 (Docker)

## 2. 상세 요구사항 (Requirements)

1.  **Milvus 연동**:
    - `docker-compose.infra.yml`에 정의된 Milvus 서비스(`milvus-standalone`)와 연결.
    - Collection 관리 (생성, 인덱싱) 기능 구현.
2.  **Document Embedding**:
    - 텍스트 데이터를 Vector로 변환하여 저장하는 기능 (`EmbeddingsService`).
    - Embedding Model: `text-embedding-3-small` (OpenAI) 또는 `text-embedding-004` (Google).
3.  **RAG Pipeline**:
    - 사용자 질문 -> Embedding -> Vector Search (Retriever) -> Prompt Engineering -> LLM -> 응답.
4.  **API Endpoint**:
    - `POST /api/ai/index`: 문서(텍스트)를 Vector DB에 저장.
    - `POST /api/ai/rag`: RAG 기반 질의응답.

## 3. 기술적 의사결정 (Technical Decisions)

- **Vector Store**: LangChain의 `Milvus` 클래스 활용.
- **Embeddings**: `GoogleGenerativeAIEmbeddings` (Gemini API Key 활용 가능 시) 또는 `OpenAIEmbeddings`. 비용 효율적인 Google Gemini 우선 고려.
- **Infrastructure**: `milvus-standalone` (gRPC: 19530).

## 4. 작업 단위 (Work Units)

1.  **Dependency**: `@langchain/milvus` 및 Embedding 패키지 설치.
2.  **Service Implementation**:
    - `VectorStoreService`: Milvus 연결 및 문서 저장/조회.
    - `RagService`: RAG 로직 (Chain) 구성.
3.  **Controller Update**: `AiController`에 Indexing 및 RAG Endpoints 추가.
4.  **Testing**: Mock 데이터를 이용한 저장 및 검색 흐름 검증.

## 5. 승인 기준 (Acceptance Criteria)

- [ ] `ai-service` 빌드 성공.
- [ ] `/api/ai/index` 요청 시 Milvus에 데이터가 저장되어야 함 (로그 확인).
- [ ] `/api/ai/rag` 요청 시 검색된 문맥(Context)을 포함한 LLM 응답이 반환되어야 함.
