# Phase 1.4 ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ìŠ¤ìºí´ë”© ì‘ì—… ì™„ë£Œ ë³´ê³ ì„œ

**ì‘ì—… ID**: 1.4_scaffolding_system  
**ì‘ì—… ê¸°ê°„**: 2025-11-30  
**ì‘ì—… ìƒíƒœ**: âœ… ì™„ë£Œ

---

## 1. ì‘ì—… ê°œìš”

System ë„ë©”ì¸ì˜ 3ê°œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤(Auth, System, Tenant)ë¥¼ NestJS ê¸°ë°˜ìœ¼ë¡œ ìŠ¤ìºí´ë”©í•˜ê³  Docker Compose í™˜ê²½ì—ì„œ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.

## 2. ì™„ë£Œëœ ì„œë¹„ìŠ¤

### 2.1 Auth Service (ì¸ì¦/ì¸ê°€)
- **ìœ„ì¹˜**: `apps/system/auth-service`
- **í¬íŠ¸**: 3001
- **Health Check**: âœ… `http://localhost:3001/api/health`
- **Swagger UI**: âœ… `http://localhost:3001/api`
- **Container**: `all-erp-auth-service-dev`
- **ì£¼ìš” ê¸°ëŠ¥**:
  - JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€ ì¤€ë¹„
  - Swagger API ë¬¸ì„œí™”
  - Health Check ì—”ë“œí¬ì¸íŠ¸

### 2.2 System Service (ì‹œìŠ¤í…œ/ê³µí†µ)
- **ìœ„ì¹˜**: `apps/system/system-service`
- **í¬íŠ¸**: 3002
- **Health Check**: âœ… `http://localhost:3002/api/health`
- **Swagger UI**: âœ… `http://localhost:3002/api`
- **Container**: `all-erp-system-service-dev`
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ê³µí†µ ì½”ë“œ ê´€ë¦¬ ì¤€ë¹„
  - ì¡°ì§/ë¶€ì„œ ê´€ë¦¬ ì¤€ë¹„
  - Swagger API ë¬¸ì„œí™”

### 2.3 Tenant Service (í…Œë„ŒíŠ¸ ê´€ë¦¬)
- **ìœ„ì¹˜**: `apps/system/tenant-service`
- **í¬íŠ¸**: 3006
- **Health Check**: âœ… `http://localhost:3006/api/health`
- **Swagger UI**: âœ… `http://localhost:3006/api`
- **Container**: `all-erp-tenant-service-dev`
- **ì£¼ìš” ê¸°ëŠ¥**:
  - ë©€í‹°í…Œë„Œì‹œ ê´€ë¦¬ ì¤€ë¹„
  - í…Œë„ŒíŠ¸ CRUD ì¤€ë¹„
  - Swagger API ë¬¸ì„œí™”

## 3. ê¸°ìˆ  ìŠ¤íƒ

```mermaid
graph TB
    subgraph "Container Runtime"
        Docker["Docker ğŸ³"]
        Compose["Docker Compose"]
    end
    
    subgraph "Application"
        NestJS["NestJS Framework"]
        Nx["Nx Monorepo"]
        Node["Node.js 22 Alpine"]
    end
    
    subgraph "Libraries"
        Swagger["@nestjs/swagger"]
        Validator["class-validator"]
        Config["@all-erp/shared/config"]
    end
    
    Docker --> Compose
    Compose --> Node
    Node --> Nx
    Nx --> NestJS
    NestJS --> Swagger
    NestJS --> Validator
    NestJS --> Config
```

## 4. í•´ê²°í•œ ë¬¸ì œ

### 4.1 í™˜ê²½ë³€ìˆ˜ ê²€ì¦ ì—ëŸ¬

**ë¬¸ì œ**:
```
âŒ Invalid environment variables: {
  NEXT_PUBLIC_API_URL: { _errors: [ 'Invalid input: expected string, received undefined' ] }
}
```

**ì›ì¸ ë¶„ì„**:
- `libs/shared/config` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œ ëª¨ë‘ì—ì„œ ì‚¬ìš©ë¨
- `NEXT_PUBLIC_API_URL`ì´ í•„ìˆ˜ í•­ëª©ìœ¼ë¡œ ì •ì˜ë˜ì–´ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨

**í•´ê²° ë°©ë²•**:

[validate-config.ts](file:///data/all-erp/libs/shared/config/src/lib/validate-config.ts) ë¦¬íŒ©í† ë§:

1. **ê³µí†µ Base Schema** ìƒì„±:
   ```typescript
   const baseEnvSchema = z.object({
     NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
     TZ: z.string().default('Asia/Seoul'),
   });
   ```

2. **Backend Schema** (NestJS ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤):
   - DB, Redis, RabbitMQ, JWT ì„¤ì •
   - ëª¨ë“  í•­ëª© optionalë¡œ ìœ ì—°ì„± ì œê³µ

3. **Frontend Schema** (Next.js):
   - NEXT_PUBLIC_API_URL í•„ìˆ˜
   - PORT ê¸°ë³¸ê°’ 4200

4. **ê²€ì¦ í•¨ìˆ˜ ë¶„ë¦¬**:
   - `validateConfig()`: ê¸°ë³¸ ê²€ì¦ (ìœ ì—°í•¨)
   - `validateBackendConfig()`: ë°±ì—”ë“œ ì „ìš© (ì—„ê²©í•¨)
   - `validateFrontendConfig()`: í”„ë¡ íŠ¸ì—”ë“œ ì „ìš© (ì—„ê²©í•¨)

**ê²°ê³¼**: 
- âœ… ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë“¤ì´ ì •ìƒ ì‹œì‘
- âœ… í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ë„ ë³„ë„ ê²€ì¦ ê°€ëŠ¥
- âœ… ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì— ì í•©í•œ ìœ ì—°í•œ êµ¬ì¡°

## 5. Docker Compose êµ¬ì„±

### 5.1 ì‹¤í–‰ ëª…ë ¹ì–´
```bash
cd dev-environment
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml up -d
```

### 5.2 ì„œë¹„ìŠ¤ êµ¬ì„±

```yaml
# docker-compose.dev.yml
services:
  auth-service:
    ports:
      - "3001:3001"
      - "9229:9229"  # Debug
    volumes:
      - ../apps:/workspace/apps:cached
      - ../libs:/workspace/libs:cached
    command: pnpm nx serve auth-service --host=0.0.0.0
    networks:
      - all-erp-network
```

### 5.3 Hot Reload ì§€ì›
- âœ… ë¡œì»¬ `apps/`, `libs/` ë””ë ‰í† ë¦¬ë¥¼ ë³¼ë¥¨ ë§ˆìš´íŠ¸
- âœ… Nx watch modeë¡œ ìë™ ì¬ì»´íŒŒì¼
- âœ… ì½”ë“œ ìˆ˜ì • ì‹œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ìë™ ë°˜ì˜

## 6. ê²€ì¦ ê²°ê³¼

### 6.1 Health Check
```bash
$ curl http://localhost:3001/api/health
{"status":"ok"}

$ curl http://localhost:3002/api/health
{"status":"ok"}

$ curl http://localhost:3006/api/health
{"status":"ok"}
```

### 6.2 Swagger UI
- âœ… Auth Service: `http://localhost:3001/api`
- âœ… System Service: `http://localhost:3002/api`
- âœ… Tenant Service: `http://localhost:3006/api`

### 6.3 ì»¨í…Œì´ë„ˆ ìƒíƒœ
```bash
$ docker compose ps
NAME                           STATUS
all-erp-auth-service-dev      Up
all-erp-system-service-dev    Up
all-erp-tenant-service-dev    Up
all-erp-postgres              Up (healthy)
all-erp-redis                 Up (healthy)
all-erp-rabbitmq              Up (healthy)
```

## 7. íŒŒì¼ ë³€ê²½ ì‚¬í•­

### 7.1 ìƒì„±ëœ íŒŒì¼
- `apps/system/auth-service/`
- `apps/system/system-service/`
- `apps/system/tenant-service/`

### 7.2 ìˆ˜ì •ëœ íŒŒì¼
- [libs/shared/config/src/lib/validate-config.ts](file:///data/all-erp/libs/shared/config/src/lib/validate-config.ts)
  - ë°±ì—”ë“œ/í”„ë¡ íŠ¸ì—”ë“œ ë¶„ë¦¬ëœ í™˜ê²½ë³€ìˆ˜ ìŠ¤í‚¤ë§ˆ
  - ì„œë¹„ìŠ¤ íƒ€ì…ë³„ ê²€ì¦ í•¨ìˆ˜ ì¶”ê°€

- [dev-environment/docker-compose.dev.yml](file:///data/all-erp/dev-environment/docker-compose.dev.yml)
  - 3ê°œ ì„œë¹„ìŠ¤ ì •ì˜ (ì´ë¯¸ ì¡´ì¬í–ˆìŒ)

## 8. ìŠ¹ì¸ ê¸°ì¤€ ë‹¬ì„± ì—¬ë¶€

| ìŠ¹ì¸ ê¸°ì¤€ | ìƒíƒœ | ë¹„ê³  |
|---------|------|-----|
| Docker Composeë¡œ ì„œë¹„ìŠ¤ ì‹œì‘ | âœ… | `docker compose up -d` ì„±ê³µ |
| Swagger UI í™•ì¸ | âœ… | 3ê°œ ì„œë¹„ìŠ¤ ëª¨ë‘ `/api` ì ‘ì† ê°€ëŠ¥ |
| Health Check í™•ì¸ | âœ… | 3ê°œ ì„œë¹„ìŠ¤ ëª¨ë‘ `{"status":"ok"}` ì‘ë‹µ |
| Hot Reload ë™ì‘ | âœ… | ì†ŒìŠ¤ ì½”ë“œ ìˆ˜ì • ì‹œ ìë™ ë°˜ì˜ í™•ì¸ |

## 9. ë‹¤ìŒ ë‹¨ê³„

Phase 1.4ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ, ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **Phase 1.5**: HR ë„ë©”ì¸ ì„œë¹„ìŠ¤ ìŠ¤ìºí´ë”©
   - personnel-service (3011)
   - payroll-service (3012)
   - attendance-service (3013)

2. **Phase 1.6**: Finance ë„ë©”ì¸ ì„œë¹„ìŠ¤ ìŠ¤ìºí´ë”©
   - budget-service (3021)
   - accounting-service (3022)
   - settlement-service (3023)

3. **Phase 1.7**: General ë„ë©”ì¸ ì„œë¹„ìŠ¤ ìŠ¤ìºí´ë”©
   - asset-service (3031)
   - supply-service (3032)
   - general-affairs-service (3033)

## 10. ì°¸ê³  ë¬¸ì„œ

- [PRD: 1.4_scaffolding_system.md](file:///data/all-erp/docs/tasks/phase1-init/1.4_scaffolding_system.md)
- [Docker-First Workflow Guide](file:///data/all-erp/docs/guides/docker-first-workflow.md)
- [Multitenancy Architecture](file:///data/all-erp/docs/architecture/multitenancy.md)

---

**ì‘ì„±ì¼**: 2025-11-30  
**ì‘ì„±ì**: AI Development Team  
**ê²€í† ì**: -  
**ìŠ¹ì¸ì**: -
