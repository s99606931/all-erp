# Task: ì• í”Œë¦¬ì¼€ì´ì…˜ ê´€ì¸¡ì„± ì ìš© (Apply Observability)

## 1. ê°œìš” (Overview)
- **ëª©í‘œ**: Shared Infrastructure ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìˆ˜ì •í•˜ì—¬ ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì— OpenTelemetry Tracingê³¼ êµ¬ì¡°í™”ëœ ë¡œê¹…(Winston+Loki)ì„ ì¼ê´„ ì ìš©.
- **ì‘ì—… ìœ í˜•**: ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìˆ˜ì • (Typescript)
- **ì„ í–‰ ì‘ì—…**: `docs/tasks/phase2-optimization/2.1_setup_observability.md` (ì¸í”„ë¼ êµ¬ì¶•)

## 2. ìƒì„¸ ì‘ì—… ê³„íš (Detailed Plan)

### 2.1 ğŸ“¦ ì˜ì¡´ì„± ì¶”ê°€ (Dependencies)
`package.json`ì— OpenTelemetry ë° Loki ê´€ë ¨ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
- `nestjs-otel`: NestJSìš© OpenTelemetry ë˜í¼
- `@opentelemetry/sdk-node`: Node.js SDK
- `@opentelemetry/exporter-trace-otlp-grpc`: Tempoë¡œ ì „ì†¡
- `winston-loki`: Lokië¡œ ë¡œê·¸ ì „ì†¡

### 2.2 ğŸ›¡ï¸ Shared Infra ìˆ˜ì •
`libs/shared/infra`ë¥¼ ìˆ˜ì •í•˜ì—¬ ëª¨ë“  ì„œë¹„ìŠ¤ì— ìë™ ì ìš©ë˜ë„ë¡ í•©ë‹ˆë‹¤.

1. **OpenTelemetry ì„¤ì • íŒŒì¼ ìƒì„±** (`libs/shared/infra/src/lib/observability/otel.config.ts`)
   - ì„œë¹„ìŠ¤ ì´ë¦„ì„ í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ SDK ì´ˆê¸°í™”.
   - OTLP Exporter ì„¤ì • (Tempo:4317).

2. **Logger ì„¤ì • ì—…ë°ì´íŠ¸** (`libs/shared/infra/src/lib/logger/winston.config.ts`)
   - ê¸°ì¡´ Console ì „ì†¡ ì™¸ì— `LokiTransport` ì¶”ê°€.
   - ë¡œê·¸ í¬ë§·ì— `traceId`, `spanId` ìë™ ì£¼ì….

3. **Bootstrap ìˆ˜ì •** (`libs/shared/infra/src/lib/bootstrap/bootstrap.ts`)
   - `bootstrapService` ì‹¤í–‰ ì‹œì‘ ë¶€ë¶„ì— OpenTelemetry SDK ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ.

### 2.3 ğŸ§ª ê²€ì¦ (Verification)
1. `docker compose up -d auth-service` ì‹¤í–‰.
2. API í˜¸ì¶œ (`curl http://localhost:3001/api/auth/health`).
3. Grafana Exploreì—ì„œ:
   - **Loki**: í•´ë‹¹ ì„œë¹„ìŠ¤ ë¡œê·¸ ê²€ìƒ‰, `traceId` í¬í•¨ ì—¬ë¶€ í™•ì¸.
   - **Tempo**: í•´ë‹¹ `traceId`ë¡œ íŠ¸ë ˆì´ìŠ¤ ì¡°íšŒ ì„±ê³µ ì—¬ë¶€ í™•ì¸.

## 3. ìˆ˜ì • ì˜ˆì • íŒŒì¼ (Files to Modify)
- `[MODIFY] package.json`
- `[MODIFY] libs/shared/infra/src/lib/bootstrap/bootstrap.ts`
- `[MODIFY] libs/shared/infra/src/lib/logger/winston.config.ts`
- `[NEW] libs/shared/infra/src/lib/observability/otel.sdk.ts`

## 4. ì™„ë£Œ ì¡°ê±´ (Definition of Done)
- [ ] ì„œë²„ ì‹œì‘ ì‹œ "OpenTelemetry SDK started" ë¡œê·¸ í™•ì¸.
- [ ] API ìš”ì²­ ì‹œ ë¡œê·¸ê°€ Lokiì— ì ì¬ë˜ê³ , Tempo ë§í¬ê°€ ìƒì„±ë¨.
