# PRD: AI Domain 서비스 구현

## 1. 개요 (Overview)
- **Task ID**: 4.4_ai_domain_impl
- **목표**: LLM 및 ML 모델을 활용한 지능형 업무 자동화 기능을 구현합니다.
- **관련 로드맵**: Phase 4 - AI Domain 서비스 병렬 개발

## 2. 상세 요구사항 (Requirements)

### 2.1 AI Assistant (사내 규정 챗봇)
- [ ] **RAG Pipeline**: 사내 규정 문서를 Embedding하여 Vector DB에 저장
- [ ] **질의응답**: 사용자 질문에 대해 관련 규정을 검색하고 LLM으로 답변 생성
- [ ] **Prompt Engineering**: 정확한 답변을 위한 프롬프트 템플릿 작성

### 2.2 Automated Accounting (자동 분개)
- [ ] **OCR**: 영수증 이미지를 텍스트로 변환 (Google Vision API 또는 Tesseract)
- [ ] **계정과목 추천**: 영수증 내용을 분석하여 적합한 계정과목 추천
# PRD: AI Domain 서비스 구현

## 1. 개요 (Overview)
- **Task ID**: 4.4_ai_domain_impl
- **목표**: LLM 및 ML 모델을 활용한 지능형 업무 자동화 기능을 구현합니다.
- **관련 로드맵**: Phase 4 - AI Domain 서비스 병렬 개발

## 2. 상세 요구사항 (Requirements)

### 2.1 AI Assistant (사내 규정 챗봇)
- [ ] **RAG Pipeline**: 사내 규정 문서를 Embedding하여 Vector DB에 저장
- [ ] **질의응답**: 사용자 질문에 대해 관련 규정을 검색하고 LLM으로 답변 생성
- [ ] **Prompt Engineering**: 정확한 답변을 위한 프롬프트 템플릿 작성

### 2.2 Automated Accounting (자동 분개)
- [ ] **OCR**: 영수증 이미지를 텍스트로 변환 (Google Vision API 또는 Tesseract)
- [ ] **계정과목 추천**: 영수증 내용을 분석하여 적합한 계정과목 추천
- [ ] **신뢰도 표시**: AI 추천 결과의 신뢰도를 함께 제공하여 사용자가 최종 판단

### 2.3 Anomaly Detection (이상 탐지)
- [ ] **법인카드 사용 패턴 분석**: 평소와 다른 거래가 발생하면 알림
- [ ] **예산 초과 조기 경보**: 현재 집행 추세로는 예산 초과가 예상될 경우 미리 경고

### 2.4 RAG 문서 관리 (Knowledge Base)
- [ ] **문서 업로드**: PDF, TXT, DOCX 파일 업로드 및 파싱 (LangChain Loader)
- [ ] **청킹 및 임베딩**: 텍스트 분할 (RecursiveCharacterTextSplitter) 및 Vector DB 저장
- [ ] **검색 테스트**: 유사도 검색 API 구현

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 LLM 모델
- **선택지 A**: OpenAI GPT-4o (SaaS) - 초기 구축 용이, 데이터 외부 전송 이슈
- **선택지 B**: **Self-hosted Open LLM** (vLLM + Hugging Face) - 데이터 보안, 비용 효율성(GPU 보유 시)
- **✅ 권장사항**: **Self-hosted Open LLM**
    - **엔진**: **vLLM** (고성능 추론 엔진, OpenAI API 호환)
    - **모델**: **Llama 3 (8B/70B)** 또는 **Mistral** (Hugging Face에서 다운로드)
    - **하드웨어**: NVIDIA GPU 장착 서버 별도 운영 필요

### 3.2 Vector DB
- **선택지 A**: Pinecone (Managed)
- **선택지 B**: Qdrant (Self-hosted, Rust)
- **선택지 C**: **Milvus** (Self-hosted, Go, Scalable)
- **✅ 권장사항**: **Milvus** (대규모 데이터 처리에 유리, etcd/MinIO 의존성 있음)

### 3.3 백엔드 프레임워크
- **선택지 A**: NestJS (Node.js) - 기존 마이크로서비스와 통일성
- **선택지 B**: **FastAPI (Python)** - AI/ML 라이브러리(LangChain, PyTorch) 활용 최적화
- **✅ 권장사항**: **FastAPI (Python)**
    - **이유**: RAG 파이프라인(임베딩, 청킹) 및 ML 모델 서빙에 Python 생태계가 필수적입니다.

## 4. 작업 단위 (Work Breakdown)

1.  **FastAPI 프로젝트 스캐폴딩**:
    - Poetry 사용 권장
    - `apps/ai/ai-service` 디렉토리 구조 설정

2.  **Milvus 연동**:
    - pymilvus 활용
    - Collection(Index) 설계

3.  **RAG 파이프라인 구현**:
    - LangChain Python 사용
    - 문서 로더 (PyPDF, TextLoader)
    - 텍스트 분할기 (RecursiveCharacterTextSplitter)
    - 임베딩 모델 연동

4.  **API 구현**:
    - `/api/v1/chat`: RAG 기반 질의응답
    - `/api/v1/documents`: 문서 업로드 및 임베딩 처리

5.  **자동 분개 및 이상 탐지**:
    - Pandas, Scikit-learn 활용
    - OCR 연동 (Tesseract 또는 Google Vision API)

6.  **Docker Compose에서 테스트**:
    ```bash
    # AI Service 및 Milvus 실행
    cd dev-environment
    docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml up -d ai-service
    
    # RAG 테스트
    curl -X POST http://localhost:3007/api/v1/chat \
      -H "Content-Type: application/json" \
      -d '{"question":"연차 규정은?"}'
    
    # 문서 업로드
    curl -X POST http://localhost:3007/api/v1/documents \
      -F "file=@/path/to/document.pdf"
    
    # Swagger UI (FastAPI 자동 생성)
    open http://localhost:3007/docs
    ```

> **참고**: [Docker-First Workflow Guide](../../guides/docker-first-workflow.md)

## 5. 승인 기준 (Acceptance Criteria)
- [ ] **RAG 질의응답**: Docker Compose 환경에서 사용자의 자연어 질문에 대해 RAG를 활용하여 정확한 답변 제공
- [ ] **문서 임베딩**: 업로드된 문서가 Milvus Vector DB에 정상적으로 임베딩되어 저장
- [ ] **OCR**: 영수증 이미지 업로드 시 OCR을 통해 텍스트 추출
- [ ] **이상 탐지**: 비정상적인 법인카드 사용 시 담당자에게 알림 발송
- [ ] **Swagger UI**: FastAPI `http://localhost:3007/docs`에서 API 테스트 가능
