# PRD: 비기능 요건 검증 (NFR Testing)

## 1. 개요 (Overview)
- **Task ID**: 6.2_nfr_testing
- **목표**: 보안, 성능, 안정성 등 비기능적 요구사항을 검증하여 운영 환경 배포 준비를 완료합니다.
- **관련 로드맵**: Phase 6 - 비기능 요건 검증

## 2. 상세 요구사항 (Requirements)

### 2.1 보안 감사 (Security Audit)
- [ ] **취약점 스캔**: OWASP ZAP 또는 Snyk을 활용한 알려진 취약점 점검
- [ ] **인증/인가 테스트**: JWT 조작, 권한 우회 시도 등 모의 해킹
- [ ] **SQL Injection 방지**: Prisma ORM 사용으로 기본 방어되지만, 추가 검증

### 2.2 부하 테스트 (Load Testing)
- [ ] **도구**: k6 또는 Apache JMeter
- [ ] **시나리오**: 동시 사용자 100명, 1000명 시 응답 시간 및 에러율 측정
- [ ] **임계치 설정**: 평균 응답 시간 < 500ms, 에러율 < 1%

### 2.3 장애 복구 훈련 (Chaos Engineering)
- [ ] **서비스 다운 시나리오**: 특정 서비스를 강제 종료하고 다른 서비스 영향 확인
- [ ] **DB 장애 시나리오**: DB 연결 끊김 시 재연결 로직 검증
- [ ] **네트워크 지연**: 인위적 지연 주입하여 Timeout 처리 확인

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 부하 테스트 도구
- **✅ 권장사항**: **k6** (JavaScript 기반 스크립트, Grafana 연동)
    - **이유**: 코드로 시나리오를 작성하고 CI/CD에 통합하기 용이합니다.

### 3.2 Chaos Engineering 도구
- **✅ 권장사항**: **초기에는 수동** (Docker stop 등) → 추후 **Chaos Mesh** 도입 고려

## 4. 작업 단위 (Work Breakdown)

1.  **보안 감사**:
    - OWASP ZAP 또는 Snyk 설치 및 실행
    - JWT 조작, 권한 우회 시도 등 모의 해킹

2.  **부하 테스트 스크립트 작성**:
    - k6 설치 및 시나리오 작성 (로그인, 데이터 조회, 등록)
    - 동시 사용자 100명, 1000명 시나리오

3.  **Docker Compose로 부하 테스트**:
    ```bash
    # 전체 환경 실행
    cd dev-environment
    docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml up -d
    
    # k6 부하 테스트 실행
    k6 run --vus 100 --duration 30s load-test.js
    
    # 결과 분석 (Grafana에서 실시간 모니터링)
    open http://localhost:3000
    ```

4.  **장애 시뮬레이션**:
    ```bash
    # 특정 서비스 강제 종료
    docker compose stop auth-service
    
    # 다른 서비스 영향 확인
    curl http://localhost:3002/api/health  # System Service
    
    # 서비스 재시작
    docker compose start auth-service
    ```

5.  **개선 사항 도출 및 재테스트**

> **참고**: [Docker-First Workflow Guide](../../guides/docker-first-workflow.md)

## 5. 승인 기준 (Acceptance Criteria)
- [ ] **보안**: Docker Compose 환경에서 취약점 스캔 결과 HIGH 등급 이상의 취약점 0개
- [ ] **성능**: 동시 사용자 100명 환경에서 평균 응답 시간 500ms 이하
- [ ] **장애 복구**: 특정 서비스 장애 시 다른 서비스는 정상 동작 (Circuit Breaker 동작 확인)
- [ ] **모니터링**: Grafana에서 부하 테스트 결과 실시간 확인
