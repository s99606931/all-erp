# PRD: 모니터링 및 로깅 시스템 구축

## 1. 개요 (Overview)
- **Task ID**: 6.1_monitoring_logging
- **목표**: 운영 환경에서 시스템 상태를 실시간으로 모니터링하고, 문제 발생 시 신속하게 원인을 파악할 수 있는 인프라를 구축합니다.
- **관련 로드맵**: Phase 6 - 안정화 및 운영 이관

## 2. 상세 요구사항 (Requirements)

### 2.1 로그 수집 및 분석 (Logging)
- [ ] **중앙 집중식 로깅**: 모든 서비스의 로그를 ELK Stack(Elasticsearch, Logstash/Fluentd, Kibana)으로 수집
- [ ] **구조화된 로깅**: JSON 포맷으로 로그 출력 (`winston` 사용)
- [ ] **로그 레벨 관리**: ERROR, WARN, INFO, DEBUG 등 환경별 로그 레벨 설정

### 2.2 메트릭 수집 및 시각화 (Metrics)
- [ ] **Prometheus**: 각 서비스의 메트릭(응답 시간, 에러율, CPU/메모리 사용량) 수집
- [ ] **Grafana**: 대시보드를 통해 실시간 메트릭 시각화
- [ ] **알림 설정**: 임계치 초과 시 Slack/이메일 알림

### 2.3 분산 추적 (Tracing)
- [ ] **Jaeger 또는 Zipkin**: 마이크로서비스 간 요청 흐름 추적
- [ ] **Trace ID 전파**: 모든 서비스에 `traceId`를 헤더로 전파하여 로그 연결

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 로깅 스택
- **✅ 권장사항**: **ELK Stack** (Elasticsearch + Logstash + Kibana)
    - **대안**: **Loki + Grafana** (경량, 비용 절감)

### 3.2 메트릭 수집
- **✅ 권장사항**: **Prometheus + Grafana**
    - NestJS: `@willsoto/nestjs-prometheus` 라이브러리 활용

### 3.3 트레이싱
- **✅ 권장사항**: **Jaeger** (OpenTelemetry 호환)

## 4. 작업 단위 (Work Breakdown)
1.  Winston Logger 설정 및 JSON 포맷 출력
2.  Logstash 또는 Fluentd 설정 (Docker Compose)
3.  Prometheus 메트릭 노출 (각 서비스에 `/metrics` 엔드포인트 추가)
4.  Grafana 대시보드 구성 (CPU, 메모리, API 응답 시간 등)
5.  Jaeger Agent 설정 및 Trace ID 전파 구현

## 5. 승인 기준 (Acceptance Criteria)
- [ ] Kibana에서 모든 서비스의 로그를 통합 조회할 수 있어야 한다.
- [ ] Grafana 대시보드에서 각 서비스의 CPU/메모리 사용량이 실시간으로 표시되어야 한다.
- [ ] Jaeger UI에서 하나의 요청이 여러 서비스를 거치는 과정을 추적할 수 있어야 한다.
