# PRD: Finance Domain 서비스 구현

## 1. 개요 (Overview)
- **Task ID**: 4.2_finance_domain_impl
- **목표**: 예산, 재무, 결산 관리를 위한 회계 처리 로직을 구현합니다.
- **관련 로드맵**: Phase 4 - Finance Domain 서비스 병렬 개발

## 2. 상세 요구사항 (Requirements)

### 2.1 Budget Service (예산회계)
- [ ] **예산 편성**: 부서별/항목별 예산 편성 및 배정
- [ ] **예산 집행**: 실시간 예산 집행 현황 추적
- [ ] **예산 변경**: 전용, 이체 등 예산 조정 프로세스

### 2.2 Accounting Service (재무회계)
- [ ] **지출 품의**: 지출 요청 및 결재 워크플로우
- [ ] **전표 처리**: 차변/대변 자동 분개 (AI 연동 고려)
- [ ] **자금 배정**: 집행 가능 예산 범위 내 자금 배정

### 2.3 Settlement Service (회계결산)
- [ ] **결산서 생성**: 월별/연도별 재무제표 자동 생성
- [ ] **계정별 집계**: 손익계산서, 재무상태표 작성
- [ ] **감사 추적**: 모든 회계 처리 이력 기록

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 회계 정밀도 (Precision)
- **✅ 필수**: 모든 금액은 **`Decimal`** 타입 사용 (`Prisma.Decimal` 또는 `decimal.js`)
- **이유**: `number` 타입의 부동소수점 오차는 회계에서 치명적입니다.

### 3.2 복식부기 구현
- **차변/대변 검증**: 모든 전표는 차변 합계 = 대변 합계를 만족해야 함 (DB Constraint 또는 Application Level 검증)
- **계정과목 관리**: `chart-of-accounts` 테이블로 계정과목 트리 구조 관리

### 3.3 AI 자동 분개
- `accounting-service`에서 `ai-service`를 호출하여 영수증 OCR 및 계정과목 추천 기능 구현 (Phase 4 후반부)

## 4. 작업 단위 (Work Breakdown)
1.  Prisma Schema 설계 (Budget, Account, Transaction, JournalEntry 등)
2.  `budget-service`: 예산 편성 및 집행률 계산 API
3.  `accounting-service`: 분개 처리 로직 및 전표 생성
4.  `settlement-service`: 재무제표 생성 쿼리 최적화
5.  트랜잭션 처리 및 롤백 전략 구현

## 5. 승인 기준 (Acceptance Criteria)
- [ ] 예산 초과 지출 시 에러가 발생해야 한다.
- [ ] 분개 처리 시 차변 합계 = 대변 합계가 보장되어야 한다.
- [ ] 재무제표가 실제 장부와 일치해야 한다 (합계 검증).
