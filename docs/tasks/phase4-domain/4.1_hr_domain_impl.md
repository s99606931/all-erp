# PRD: HR Domain 서비스 구현

## 1. 개요 (Overview)
- **Task ID**: 4.1_hr_domain_impl
- **목표**: 인사, 급여, 복무 관리를 위한 핵심 비즈니스 로직을 구현합니다.
- **관련 로드맵**: Phase 4 - HR Domain 서비스 병렬 개발

## 2. 상세 요구사항 (Requirements)

### 2.1 Personnel Service (인사관리)
- [ ] **인사 카드**: 직원 기본정보 CRUD
- [ ] **발령 관리**: 신규입사, 전보, 승진, 퇴사 등 인사발령 처리
- [ ] **제증명 발급**: 재직증명서, 경력증명서 자동 생성 및 출력

### 2.2 Payroll Service (급여관리)
- [ ] **급여 계산**: 기본급, 수당, 공제 항목 계산 엔진
- [ ] **급여 대장**: 월별 급여 명세서 생성 및 조회
- [ ] **연말정산**: 소득공제 항목 관리 및 원천징수영수증 발급

### 2.3 Attendance Service (복무관리)
- [ ] **근태 관리**: 출퇴근 기록, 지각/조퇴/결근 처리
- [ ] **휴가 관리**: 연차/반차/병가 신청 및 승인 워크플로우
- [ ] **출장 관리**: 출장 신청/정산

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 DB 스키마 설계
- **정규화**: 3NF 이상으로 데이터 중복 최소화
- **감사(Audit) 컬럼**: `createdAt`, `updatedAt`, `createdBy`, `updatedBy` 필수 포함
- **소프트 삭제**: 물리적 삭제 대신 `deletedAt` 컬럼을 활용한 논리적 삭제

### 3.2 급여 계산 로직
- **✅ 권장사항**: 급여 계산은 **복잡한 비즈니스 규칙**이므로, 별도의 `PayrollCalculator` 클래스로 분리하여 단위 테스트 작성
- **금액 처리**: `Decimal` 타입 사용 (부동소수점 오차 방지)

### 3.3 서비스 간 데이터 참조
- 급여 계산 시 근태 정보 필요 → `attendance-service` API 호출 또는 **Event-driven** 방식 (근태 확정 시 이벤트 발행)

## 4. 작업 단위 (Work Breakdown)

1.  **Prisma Schema 설계**:
    - 각 서비스별 ERD 작성 권장
    - Entity, Repository 패턴 설계

2.  **Personnel Service 구현**:
    - 인사 카드 CRUD API
    - 발령 관리 로직
    - 제증명 발급 기능

3.  **Payroll Service 구현**:
    - `PayrollCalculator` 클래스 분리 및 단위 테스트
    - 급여 계산 로직 (Decimal 타입 사용)
    - 월별 급여 명세서 생성

4.  **Attendance Service 구현**:
    - 근태 관리 및 휴가 승인 워크플로우
    - 휴가 잔여일수 자동 계산

5.  **Docker Compose에서 테스트**:
    ```bash
    # HR 서비스 실행
    cd dev-environment
    docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml up -d \
      personnel-service payroll-service attendance-service
    
    # API 테스트
    curl -X POST http://localhost:3011/api/employees \
      -H "Content-Type: application/json" \
      -d '{"name":"홀길동","department":"개발팀"}'
    
    # Swagger UI
    open http://localhost:3011/api  # Personnel
    open http://localhost:3012/api  # Payroll
    open http://localhost:3013/api  # Attendance
    ```

> **참고**: [Docker-First Workflow Guide](../../guides/docker-first-workflow.md)

## 5. 승인 기준 (Acceptance Criteria)
- [ ] **인사 카드 API**: Docker Compose 환경에서 인사 카드 CRUD API 정상 동작
- [ ] **급여 계산**: 급여 계산 결과가 실제 급여 규정과 일치 (단위 테스트로 검증)
- [ ] **휴가 관리**: 휴가 신청 시 잔여 연차가 정확히 차감
- [ ] **Swagger UI**: 각 서비스의 Swagger UI에서 API 테스트 가능
