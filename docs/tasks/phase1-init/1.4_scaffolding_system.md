# PRD: System Domain 서비스 스캐폴딩

## 1. 개요 (Overview)
- **Task ID**: 1.4_scaffolding_system
- **목표**: 시스템의 근간이 되는 `auth-service`, `system-service`, `tenant-service`의 기본 앱을 생성하고 설정을 마칩니다.
- **관련 로드맵**: Phase 1 - 서비스 스캐폴딩

## 2. 상세 요구사항 (Requirements)
- [ ] **NestJS 앱 생성**: Nx 명령어로 3개의 마이크로서비스 생성
- [ ] **기본 포트 설정**:
    - `auth-service`: 3001
    - `system-service`: 3002
    - `tenant-service`: 3006
- [ ] **기본 모듈 구성**:
    - `HealthCheckController`: `/health` 엔드포인트 (Liveness/Readiness Probe용)
    - `Swagger`: API 문서화 설정 (`/api`)
    - `ConfigModule`: 환경 변수 로드 설정

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 통신 프로토콜 (Inter-service Communication)
- **선택지 A**: HTTP (REST)
- **선택지 B**: gRPC
- **선택지 C**: Message Queue (RabbitMQ/Kafka)
- **✅ 권장사항**: **`HTTP (REST)` + `RabbitMQ` (Event-driven)**
    - **이유**: 기본 조회/명령은 REST로 개발 생산성을 높이고, 서비스 간 결합도를 낮춰야 하는 작업(예: 회원가입 후 웰컴 메일 발송)은 RabbitMQ를 사용합니다. 초기 스캐폴딩에는 REST 설정부터 포함합니다.

### 3.2 Swagger 설정
- **권장사항**: 각 서비스별로 Swagger를 독립적으로 띄우고, 추후 API Gateway나 별도의 포털에서 통합해서 볼 수 있도록 JSON 출력을 지원해야 합니다.

## 4. 작업 단위 (Work Breakdown)
1.  Nx CLI로 각 서비스 생성:
    - `pnpm nx g @nx/nest:app --directory=apps/system/auth-service --name=auth-service --no-interactive`
    - `pnpm nx g @nx/nest:app --directory=apps/system/system-service --name=system-service --no-interactive`
    - `pnpm nx g @nx/nest:app --directory=apps/system/tenant-service --name=tenant-service --no-interactive`
2.  각 서비스 설정:
    - `main.ts`: Swagger, ValidationPipe, Health Check 설정
    - `app.module.ts`: ConfigModule 설정
    - 포트: 환경변수 `PORT` 사용, 기본값 설정 (3001, 3002, 3006)
3.  **Docker Compose 통합**:
    - `dev-environment/docker-compose.dev.yml`에 3개 서비스 정의 추가 (이미 존재함)
    - 볼륨 마운트 설정 확인: `../apps:/workspace/apps:cached`
4.  **Docker Compose로 실행 및 검증**:
    - `cd dev-environment && docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml up -d`

> **참고**: [Docker-First Workflow Guide](../../guides/docker-first-workflow.md)

## 5. 승인 기준 (Acceptance Criteria)
- [ ] **Docker Compose로 서비스 시작**: `docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml up -d` 실행 성공
- [ ] **Swagger UI 확인**:
    - `http://localhost:3001/api` (Auth Service)
    - `http://localhost:3002/api` (System Service)
    - `http://localhost:3006/api` (Tenant Service)
- [ ] **Health Check 확인**: 각 서비스의 `/api/health` 엔드포인트에서 `{ "status": "ok" }` 응답
- [ ] **Hot Reload 동작**: 로컬에서 소스 코드 수정 시 컨테이너 내부에서 자동 재시작
