# Task 1.3: Setup Observability (Metrics & Health)

## 1. 개요 (Overview)

- **Task ID**: 1.3
- **목표**: Prometheus 메트릭 수집과 Kubernetes/Docker 헬스 체크를 위한 엔드포인트를 노출한다.

## 2. 상세 요구사항 (Requirements)

1.  **Health Check**:
    - `/health` 엔드포인트 제공.
    - DB 연결 상태, 메모리 사용량 등을 체크.
2.  **Metrics**:
    - `/metrics` 엔드포인트 제공.
    - HTTP 요청 수, 응답 시간, 에러율 등 표준 메트릭 노출.

## 3. 기술적 의사결정 (Technical Decisions)

- **Library**:
  - Health: `@nestjs/terminus` (표준)
  - Metrics: `@willsoto/nestjs-prometheus`
- **Security**: `/metrics` 엔드포인트는 외부 노출 시 주의 필요 (현재는 내부망 전제로 오픈)

## 4. 작업 단위 (Work Units)

1.  **`libs/shared/infra` 의존성 추가**:
    - `pnpm add @nestjs/terminus @willsoto/nestjs-prometheus prom-client`
2.  **`SharedInfraModule` 수정**:
    - `PrometheusModule` 등록.
    - `TerminusModule` 등록 및 `HealthController` 구현.
3.  **`docker-compose.devops.yml` 검증**:
    - Prometheus 컨테이너가 각 서비스의 `/metrics`를 스크랩하도록 설정 (`prometheus.yml` 수정 필요할 수 있음)

## 5. 승인 기준 (Acceptance Criteria)

- [ ] `http://localhost:3001/health` 호출 시 `{ status: "ok", ... }` 응답.
- [ ] `http://localhost:3001/metrics` 호출 시 Prometheus 포맷의 텍스트 응답.
