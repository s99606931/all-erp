# Task 1.2: Implement Shared Infrastructure (Logging & Exceptions)

## 1. 개요 (Overview)

- **Task ID**: 1.2
- **목표**: 모든 마이크로서비스에 표준화된 로깅(Logging)과 에러 처리(Exception Handling)를 적용하여 운영 효율성과 디버깅 용이성을 높인다.

## 2. 상세 요구사항 (Requirements)

1.  **LoggingInterceptor**:
    - 모든 HTTP 요청(메서드, URL, Body, IP)과 응답(Status, 소요 시간)을 JSON 구조로 로깅.
    - `winston` 기반의 구조화된 로그 사용.
2.  **GlobalExceptionFilter**:
    - 모든 예외 상황에 대해 통일된 JSON 포맷으로 응답.
    - `{ statusCode, message, timestamp, path, traceId }` 포함.
3.  **공통 모듈 적용**: `libs/shared/infra` 라이브러리에 구현하고 `bootstrapService`에 기본 적용.

## 3. 기술적 의사결정 (Technical Decisions)

- **Logger**: `nest-winston` 사용 (JSON 포맷팅 용이)
- **Log Level**: 개발 환경(`debug`), 운영 환경(`info`)
- **Trace ID**: `nestjs-cls` 또는 Request Header의 `X-Trace-Id`를 사용하여 요청 추적.

## 4. 작업 단위 (Work Units)

1.  **`libs/shared/infra`에 `LoggingInterceptor` 구현**:
    - `libs/shared/infra/src/lib/interceptors/logging.interceptor.ts` 생성
2.  **`libs/shared/infra`에 `GlobalExceptionFilter` 구현**:
    - `libs/shared/infra/src/lib/filters/http-exception.filter.ts` 생성
3.  **`bootstrapService` 수정**:
    - 위에서 만든 Interceptor와 Filter를 전역(Global)으로 등록하는 로직 추가 (`app.useGlobalInterceptors`, `app.useGlobalFilters`)

## 5. 승인 기준 (Acceptance Criteria)

- [ ] 임의의 서비스(예: `auth-service`) API 호출 시 콘솔에 JSON 형태의 로그가 출력되어야 한다.
- [ ] 강제로 에러 발생 시(예: 404), 정의된 표준 포맷의 JSON 에러 응답이 와야 한다.
