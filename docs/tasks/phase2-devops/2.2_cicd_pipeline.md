# PRD: CI/CD 파이프라인 구축

## 1. 개요 (Overview)
- **Task ID**: 2.2_cicd_pipeline
- **목표**: 코드 변경 사항을 자동으로 검증(Test/Lint)하고, 빌드하여 배포 가능한 아티팩트(Docker Image)를 생성하는 파이프라인을 구축합니다.
- **관련 로드맵**: Phase 2 - CI/CD 파이프라인

## 2. 상세 요구사항 (Requirements)
- [ ] **PR 검증 워크플로우**: Pull Request 생성 시 Lint, Test, Build 동작 수행
- [ ] **Nx Affected 기능 활용**: 변경된 프로젝트만 감지하여 빌드/테스트 수행 (시간 단축)
- [ ] **이미지 빌드 및 푸시**: Main 브랜치 병합 시 Docker Image 빌드 후 레지스트리(GHCR/ECR) 푸시

## 3. 기술적 의사결정 (Technical Decisions)

### 3.1 CI 도구
- **✅ 권장사항**: **GitHub Actions**
    - **이유**: 소스 코드와 통합되어 있고, Nx와의 호환성이 뛰어납니다.

### 3.2 캐싱 전략 (Caching)
- **Nx Cloud** 또는 **GitHub Actions Cache** 활용
    - `pnpm` 의존성 캐싱
    - Nx 빌드 결과 캐싱 (이전 빌드 재사용)

## 4. 작업 단위 (Work Breakdown)

1.  **GitLab CI/CD 설정** (`.gitlab-ci.yml` 생성):
    - **Lint/Test**: PR/MR 생성 시 자동 검증
    - **Build**: Docker 이미지 빌드
    - **Push**: GitLab Container Registry에 이미지 푸시
    
2.  **Nx Affected 활용**:
    ```yaml
    # .gitlab-ci.yml 예시
    test:
      script:
        - pnpm nx affected:test --base=origin/main
    
    build:
      script:
        - pnpm nx affected:build --base=origin/main --prod
    ```

3.  **Docker 이미지 빌드 및 푸시**:
    ```yaml
    docker-build:
      image: docker:latest
      services:
        - docker:dind
      script:
        - docker build -f Dockerfile.dev -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
        - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    ```

4.  **캠싱 전략**:
    - GitLab CI 캠시 활용 (`cache:` 키워드)
    - `pnpm` 의존성 캠싱
    - Nx 캨스 캠싱

> **참고**: [Docker-First Workflow Guide](../../guides/docker-first-workflow.md)

## 5. 승인 기준 (Acceptance Criteria)
- [ ] **MR 검증**: Merge Request를 올렸을 때 자동으로 테스트가 동작하고 성공/실패 표시
- [ ] **Nx Affected 동작**: 변경되지 않은 서비스는 빌드 건너뛰기
- [ ] **Docker 이미지 푸시**: 빌드된 이미지가 GitLab Container Registry에 정상 저장
