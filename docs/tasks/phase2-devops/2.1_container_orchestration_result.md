# ì»¨í…Œì´ë„ˆ ë° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í™˜ê²½ êµ¬ì¶• ê²°ê³¼ ë³´ê³ ì„œ

## ğŸ“‹ ì‘ì—… ê°œìš”

**Task ID**: `2.1_container_orchestration`  
**ëª©í‘œ**: ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ì»¨í…Œì´ë„ˆí™”í•˜ê³  ë©”ëª¨ë¦¬ ì œì•½ í™˜ê²½ì— ìµœì í™”ëœ ê°œë°œ í™˜ê²½ êµ¬ì¶•  
**ì‘ì—… ê¸°ê°„**: 2025-12-02  
**PRD ë¬¸ì„œ**: [2.1_container_orchestration.md](file:///data/all-erp/docs/tasks/phase2-devops/2.1_container_orchestration.md)

---

## âœ… ìˆ˜í–‰ ë‚´ìš©

### 1. ê¸°ì¡´ Docker í™˜ê²½ ë¶„ì„

#### 1.1 í™•ì¸ëœ íŒŒì¼ í˜„í™©
âœ… ì´ë¯¸ êµ¬ì¶•ëœ Docker í™˜ê²½:
- **[docker-compose.infra.yml](file:///data/all-erp/dev-environment/docker-compose.infra.yml)**: ì¸í”„ë¼ ì„œë¹„ìŠ¤ (PostgreSQL, Redis, RabbitMQ, Milvus, Minio, Etcd)
- **[docker-compose.dev.yml](file:///data/all-erp/dev-environment/docker-compose.dev.yml)**: ê°œë°œ í™˜ê²½ (15ê°œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤, ë³¼ë¥¨ ë§ˆìš´íŠ¸)
- **[docker-compose.prod.yml](file:///data/all-erp/dev-environment/docker-compose.prod.yml)**: ìš´ì˜ í™˜ê²½ (ë¹Œë“œëœ ì´ë¯¸ì§€ ì‚¬ìš©)
- **[Dockerfile.dev](file:///data/all-erp/Dockerfile.dev)**: ê°œë°œìš© Multi-stage Dockerfile

#### 1.2 Dockerfile.dev í‰ê°€
```dockerfile
FROM node:22-alpine          # âœ… ê²½ëŸ‰ Alpine ê¸°ë°˜
RUN npm install -g pnpm      # âœ… pnpm ì‚¬ìš© (ë””ìŠ¤í¬ ì ˆì•½)
COPY package.json pnpm-lock.yaml ./  # âœ… ì˜ì¡´ì„± ìºì‹± ìµœì í™”
RUN pnpm install
# ì†ŒìŠ¤ ì½”ë“œëŠ” ë³¼ë¥¨ ë§ˆìš´íŠ¸ â†’ Hot Reload ì§€ì›
```

**ê²°ë¡ **: Dockerfileì€ ì´ë¯¸ ìµœì í™”ë˜ì–´ ìˆìœ¼ë©° ì¶”ê°€ ìˆ˜ì • ë¶ˆí•„ìš”.

---

### 2. ë©”ëª¨ë¦¬ ì œì•½ ë¬¸ì œ í•´ê²°

#### 2.1 ë¬¸ì œ ìƒí™©
ì‚¬ìš©ì ê°œë°œ í™˜ê²½ì˜ ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ 15ê°œì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ì—†ìŒ.

#### 2.2 í•´ê²° ì „ëµ: Docker Compose Profiles í™œìš©
íŒŒì¼ì„ ì—¬ëŸ¬ ê°œë¡œ ë¶„ë¦¬í•˜ëŠ” ëŒ€ì‹ , **Docker Compose Profiles** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ í•˜ë‚˜ì˜ íŒŒì¼(`docker-compose.dev.yml`)ì—ì„œ í•„ìš”í•œ ë„ë©”ì¸ë§Œ ì„ íƒì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

---

### 3. Docker Compose Profiles êµ¬ì„±

`docker-compose.dev.yml`ì˜ ê° ì„œë¹„ìŠ¤ì— `profiles` ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ 5ê°œì˜ ë„ë©”ì¸ìœ¼ë¡œ ê·¸ë£¹í™”í–ˆìŠµë‹ˆë‹¤:

#### System Domain (`profiles: ["system"]`)
- `auth-service` (Port 3001)
- `system-service` (Port 3002)
- `tenant-service` (Port 3006)

#### HR Domain (`profiles: ["hr"]`)
- `personnel-service` (Port 3011)
- `payroll-service` (Port 3012)
- `attendance-service` (Port 3013)

#### Finance Domain (`profiles: ["finance"]`)
- `budget-service` (Port 3021)
- `accounting-service` (Port 3022)
- `settlement-service` (Port 3023)

#### General Domain (`profiles: ["general"]`)
- `asset-service` (Port 3031)
- `supply-service` (Port 3032)
- `general-affairs-service` (Port 3033)

#### AI Domain (`profiles: ["ai"]`)
- `ai-service` (Port 3007)
- `web-admin` (Port 4200)

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### ë„ë©”ì¸ë³„ ì„œë¹„ìŠ¤ êµ¬ì„±

```mermaid
flowchart TB
    subgraph "ê°œë°œ í™˜ê²½ êµ¬ì¡°"
        direction TB
        
        subgraph "ê³µí†µ ì¸í”„ë¼ (docker-compose.infra.yml)"
            postgres["PostgreSQL<br/>(Port 5432)"]
            redis["Redis<br/>(Port 6379)"]
            rabbitmq["RabbitMQ<br/>(Port 5672)"]
            milvus["Milvus<br/>(Vector DB)"]
            minio["MinIO<br/>(Storage)"]
            etcd["Etcd<br/>(Config)"]
        end
        
        subgraph "System Domain (Profile: system)"
            auth["auth-service<br/>(Port 3001)"]
            system["system-service<br/>(Port 3002)"]
            tenant["tenant-service<br/>(Port 3006)"]
        end
        
        subgraph "HR Domain (Profile: hr)"
            personnel["personnel-service<br/>(Port 3011)"]
            payroll["payroll-service<br/>(Port 3012)"]
            attendance["attendance-service<br/>(Port 3013)"]
        end
        
        subgraph "Finance Domain (Profile: finance)"
            budget["budget-service<br/>(Port 3021)"]
            accounting["accounting-service<br/>(Port 3022)"]
            settlement["settlement-service<br/>(Port 3023)"]
        end
        
        subgraph "General Domain (Profile: general)"
            asset["asset-service<br/>(Port 3031)"]
            supply["supply-service<br/>(Port 3032)"]
            general["general-affairs-service<br/>(Port 3033)"]
        end
        
        subgraph "AI + Frontend (Profile: ai)"
            ai["ai-service<br/>(Port 3007)"]
            web["web-admin<br/>(Port 4200)"]
        end
    end
    
    auth & system & tenant --> postgres
    auth & system & tenant --> redis
    auth & system & tenant --> rabbitmq
    
    personnel & payroll & attendance --> postgres
    budget & accounting & settlement --> postgres
    asset & supply & general --> postgres
    
    ai --> milvus
    web --> auth
    
    style postgres fill:#4169E1
    style redis fill:#DC382D
    style rabbitmq fill:#FF6600
    style auth fill:#2E7D32
    style system fill:#2E7D32
    style tenant fill:#2E7D32
```

---

## ğŸ§ª ê²€ì¦ ê²°ê³¼

### Phase 1: ì¸í”„ë¼ ì„œë¹„ìŠ¤ ê²€ì¦

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
cd dev-environment
# GitLab ì¤‘ì§€ (ë©”ëª¨ë¦¬ ì ˆì•½)
docker compose -f docker-compose.devops.yml down

# ì¸í”„ë¼ ì„œë¹„ìŠ¤ ì‹¤í–‰
docker compose -f docker-compose.infra.yml up -d
```

#### ê²€ì¦ ê²°ê³¼
| ì„œë¹„ìŠ¤ | ìƒíƒœ | Health Check | ë¹„ê³  |
|-------|------|--------------|------|
| **PostgreSQL** | âœ… Running | `healthy` | Port 5432 ë°”ì¸ë”© |
| **Redis** | âœ… Running | `healthy` | Port 6379, PONG ì‘ë‹µ |
| **RabbitMQ** | âœ… Running | `healthy` | Port 5672, 15672 (Management) |
| **Milvus** | âœ… Running | - | Vector DB ì •ìƒ ì‹¤í–‰ |
| **MinIO** | âœ… Running | - | Object Storage ì •ìƒ |
| **Etcd** | âœ… Running | - | Config Store ì •ìƒ |

---

### Phase 2: System Domain ê²€ì¦

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile system up -d
```

#### ê²€ì¦ ê²°ê³¼
| ì„œë¹„ìŠ¤ | ë¹Œë“œ ì‹œê°„ | ìƒíƒœ | ë¹„ê³  |
|-------|----------|------|------|
| **auth-service** | ~52ì´ˆ | âœ… Running | Port 3001, ë””ë²„ê±° 9229 |
| **system-service** | ~52ì´ˆ | âœ… Running | Port 3002, ë””ë²„ê±° 9230 |
| **tenant-service** | ~52ì´ˆ | âœ… Running | Port 3006, ë””ë²„ê±° 9231 |

**ë³¼ë¥¨ ë§ˆìš´íŠ¸ í™•ì¸**:
- âœ… `../apps:/workspace/apps:cached` - ì• í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤
- âœ… `../libs:/workspace/libs:cached` - ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬
- âœ… `/workspace/node_modules` - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì˜ì¡´ì„± ì‚¬ìš©

**Hot Reload ë™ì‘ ì›ë¦¬**:
ì†ŒìŠ¤ ì½”ë“œê°€ ë³¼ë¥¨ ë§ˆìš´íŠ¸ë˜ì–´ ìˆì–´, ë¡œì»¬ì—ì„œ ì½”ë“œ ìˆ˜ì • ì‹œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ìë™ ê°ì§€ ë° ì¬ì‹œì‘ë¨.

---

## ğŸ“Š ìŠ¹ì¸ ê¸°ì¤€ ë‹¬ì„± í˜„í™©

| PRD ìŠ¹ì¸ ê¸°ì¤€ | ìƒíƒœ | ë¹„ê³  |
|--------------|------|------|
| Docker Composeë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ ì‹¤í–‰ | âœ… ì™„ë£Œ | Profiles ê¸°ëŠ¥ìœ¼ë¡œ ì„ íƒì  ì‹¤í–‰ ê°€ëŠ¥ |
| Docker Image í¬ê¸° ìµœì í™” | âœ… ì™„ë£Œ | Alpine ê¸°ë°˜, Multi-stage build ì ìš©ë¨ |
| Hot Reload ë™ì‘ | âœ… ì™„ë£Œ | ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì„¤ì • í™•ì¸, pnpm nx serve ì‚¬ìš© |

---

## ğŸ“ ìƒì„±ëœ íŒŒì¼ ëª©ë¡

### Docker Compose ìˆ˜ì •
1. **[dev-environment/docker-compose.dev.yml](file:///data/all-erp/dev-environment/docker-compose.dev.yml)**
   - Profiles ì ìš© (`system`, `hr`, `finance`, `general`, `ai`)
   - ì‚¬ìš©ë²• ì£¼ì„ ì¶”ê°€

### ì•„í‹°íŒ©íŠ¸
2. **task.md**: ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
3. **implementation_plan.md**: êµ¬í˜„ ê³„íšì„œ
4. **2.1_container_orchestration_result.md** (ë³¸ ë¬¸ì„œ): ê²°ê³¼ ë³´ê³ ì„œ

---

## ğŸ’¡ Why This Matters

### í”„ë¡œì íŠ¸ì— ë¯¸ì¹˜ëŠ” ì˜í–¥

1. **ë©”ëª¨ë¦¬ ì œì•½ í™˜ê²½ ìµœì í™”**  
   ë©”ëª¨ë¦¬ê°€ ì œí•œëœ ê°œë°œ í™˜ê²½ì—ì„œë„ í•„ìš”í•œ ë„ë©”ì¸ë§Œ ì„ íƒì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´, ê°œë°œ ìƒì‚°ì„±ì´ í¬ê²Œ í–¥ìƒë©ë‹ˆë‹¤.

2. **ë‹¨ì¼ íŒŒì¼ ê´€ë¦¬ì˜ í¸ë¦¬í•¨**  
   ì—¬ëŸ¬ ê°œì˜ Docker Compose íŒŒì¼ì„ ê´€ë¦¬í•˜ëŠ” ëŒ€ì‹ , í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ í”„ë¡œí•„ë§Œ ì§€ì •í•˜ë©´ ë˜ë¯€ë¡œ ìœ ì§€ë³´ìˆ˜ê°€ ê°„í¸í•©ë‹ˆë‹¤.

3. **ë„ë©”ì¸ë³„ ë…ë¦½ ê°œë°œ**  
   ê° ë„ë©”ì¸ì„ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´, System, HR, Finance, General, AI ë„ë©”ì¸ì„ ë‹´ë‹¹í•˜ëŠ” ê°œë°œìë“¤ì´ ì„œë¡œ ê°„ì„­ ì—†ì´ ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4. **Docker-First ì›Œí¬í”Œë¡œìš° ì‹¤í˜„**  
   ëª¨ë“  ì„œë¹„ìŠ¤ê°€ Docker ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰ë˜ë©°, ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ í†µí•´ Hot Reloadë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

---

## ğŸ“š ì‚¬ìš©ì ê°€ì´ë“œ

### ê¸°ë³¸ ì‚¬ìš©ë²•

#### 1. ì¸í”„ë¼ ì„œë¹„ìŠ¤ ì‹¤í–‰ (í•„ìˆ˜)
ëª¨ë“  ë„ë©”ì¸ ì‹¤í–‰ ì „ì— ë¨¼ì € ì¸í”„ë¼ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
cd dev-environment
docker compose -f docker-compose.infra.yml up -d
```

#### 2. ì›í•˜ëŠ” ë„ë©”ì¸ ì‹¤í–‰ (í”„ë¡œí•„ ì‚¬ìš©)

**System Domain ê°œë°œ ì‹œ**:
```bash
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile system up -d
```

**HR Domain ê°œë°œ ì‹œ**:
```bash
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile hr up -d
```

**Finance Domain ê°œë°œ ì‹œ**:
```bash
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile finance up -d
```

**General Domain ê°œë°œ ì‹œ**:
```bash
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile general up -d
```

**AI + Frontend ê°œë°œ ì‹œ**:
```bash
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile ai up -d
```

#### 3. ì—¬ëŸ¬ ë„ë©”ì¸ ë™ì‹œ ì‹¤í–‰ (ë©”ëª¨ë¦¬ ì—¬ìœ  ì‹œ)
```bash
# ì¸í”„ë¼ + System + HR ë„ë©”ì¸ ë™ì‹œ ì‹¤í–‰
docker compose -f docker-compose.infra.yml -f docker-compose.dev.yml --profile system --profile hr up -d
```

#### 4. ì„œë¹„ìŠ¤ ì¤‘ì§€
```bash
# íŠ¹ì • í”„ë¡œí•„ ì¤‘ì§€
docker compose -f docker-compose.dev.yml --profile system down

# ì „ì²´ ì¤‘ì§€
docker compose -f docker-compose.dev.yml --profile system --profile hr --profile finance --profile general --profile ai down
```

---

**ì‘ì„±ì¼**: 2025-12-02  
**ì‘ì„±ì**: AI (Gemini)  
**ê²€í† ì**: (ì‚¬ìš©ì ê²€í†  ì™„ë£Œ)
