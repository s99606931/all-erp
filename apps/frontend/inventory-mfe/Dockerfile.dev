# [Development] inventory-mfe Dockerfile
FROM node:22-slim

WORKDIR /app

RUN corepack enable && corepack prepare pnpm@latest --activate

# Copy root configs for dependencies
# Context: Root (..)
COPY package.json pnpm-lock.yaml* nx.json tsconfig.base.json ./

# Install dependencies
RUN pnpm install --frozen-lockfile

# App logic
EXPOSE 3108

# Start Dev Server
# Note: Source code is mounted at /app/apps/frontend/inventory-mfe map to /app ? 
# Wait, docker-compose volume maps '../apps/frontend/inventory-mfe:/app'
# So inside container, /app IS the app directory.
# BUT package.json copy above put root package.json in /app.
# This volume mount OVERWRITES /app content with app source.
# So root package.json is LOST? 
# YES.
# FIX: WORKDIR should be /workspace (Root) and mount app to /workspace/apps/frontend/inventory-mfe?
# OR: Keep current volume strategy but accept risk?
# Existing Strategy in docker-compose.frontend.yml calls for volume: ../apps/frontend/shell:/app.
# And Dockerfile.frontend.dev COPY package.json ./ (Response 206).
# If /app is overwritten, 'node_modules' volume saves deps.
# But 'package.json' (Root) is lost.
# However, 'pnpm dev' runs inside /app (App Dir). It sees App's package.json.
# It works because Dev Server doesn't need Root package.json at runtime if node_modules are present.
# So we keep the strategy.

CMD ["pnpm", "nx", "serve", "inventory-mfe", "--host", "0.0.0.0"]
